{"version":3,"sources":["../src/core/opcua-iiot-core-connector.ts"],"names":[],"mappings":"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","file":"opcua-iiot-core-connector.js","sourcesContent":["/**\n The BSD 3-Clause License\n\n Copyright 2022 - DATATRONiQ GmbH (https://datatroniq.com)\n Copyright (c) 2018-2022 Klaus Landsdorf (http://node-red.plus/)\n All rights reserved.\n node-red-contrib-iiot-opcua\n */\n\n'use strict'\n// SOURCE-MAP-REQUIRED\n\nimport * as core from './opcua-iiot-core'\n// @ts-ignore\nimport {TodoTypeAny} from \"../types/placeholders\";\nimport {ClientSession, OPCUAClient, OPCUADiscoveryServer, UserIdentityInfo} from \"node-opcua\";\nimport {OPCUAClientOptions} from \"node-opcua-client/dist/opcua_client\";\nimport {Node} from \"node-red\";\nimport {createMachine, interpret} from \"@xstate/fsm\";\nimport {ConnectorIIoT, FsmConnectorStates} from \"./opcua-iiot-core\";\n\nexport namespace logger {\n  export const internalDebugLog = core.Debug('opcuaIIoT:connector')\n  export const detailDebugLog = core.Debug('opcuaIIoT:connector:details')\n  export const libDebugLog = core.Debug('opcuaIIoT:connector:nodeopcua')\n}\n\n// sets values within node.iiot (refactored to node.iiot)\nconst initConnectorNode = (): ConnectorIIoT => {\n  return {\n    ...core.initCoreNode(),\n    sessionNodeRequests: 0,\n    endpoints: [],\n    userIdentity: undefined,\n    opcuaClient: undefined,\n    opcuaSession: undefined,\n    discoveryServer: undefined,\n    serverCertificate: undefined,\n    discoveryServerEndpointUrl: undefined,\n    hasOpcUaSubscriptions: false,\n  }\n\n}\n\ninterface ConnectorTestContext {\n  debugContext?: string\n}\n\ntype ConnectorEvent =\n    | { type: 'INITOPCUA' }\n    | { type: 'SESSIONACTIVATE'}\n    | { type: 'SESSIONRESTART'}\n    | { type: 'SESSIONCLOSE'}\n    | { type: 'SESSIONREQUEST'}\n    | { type: 'IDLE'}\n    | { type: 'LOCK'}\n    | { type: 'UNLOCK'}\n    | { type: 'END'}\n    | { type: 'CLOSE'}\n    | { type: 'OPEN'}\n    | { type: 'STOP'}\n    | { type: 'RESTART'}\n    | { type: 'RENEW'}\n    | { type: 'RECONFIGURE'};\n\ntype ConnectorState =\n    | { value: FsmConnectorStates.StateIdle; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateInit; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateOpened; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateSessionRequested; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateSessionActive; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateSessionClosed; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateSessionRestart; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateClosed; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateLocked; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateUnlocked; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateStopped; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateEnd; context: ConnectorTestContext & { debugContext: undefined } }\n    | { value: FsmConnectorStates.StateReconfigured; context: ConnectorTestContext  & { debugContext: undefined }}\n    | { value: FsmConnectorStates.StateRenewed; context: ConnectorTestContext & { debugContext: undefined } };\n\nconst createConnectorFinalStateMachine = function () {\n  return createMachine<ConnectorTestContext, ConnectorEvent, ConnectorState>({\n    id: 'connector',\n    initial: FsmConnectorStates.StateIdle,\n    states:{\n      idle: { on: {\n          INITOPCUA: FsmConnectorStates.StateInit,\n          LOCK: FsmConnectorStates.StateLocked,\n          END: FsmConnectorStates.StateEnd\n        }\n      },\n      init: { on: {\n          OPEN: FsmConnectorStates.StateOpened,\n          CLOSE: FsmConnectorStates.StateClosed,\n          LOCK: FsmConnectorStates.StateLocked,\n          END: FsmConnectorStates.StateEnd\n        }\n      },\n      opened: { on: {\n          SESSIONREQUEST: FsmConnectorStates.StateSessionRequested,\n          CLOSE: FsmConnectorStates.StateClosed,\n          LOCK: FsmConnectorStates.StateLocked,\n          END: FsmConnectorStates.StateEnd\n        }\n      },\n      sessionRequested: { on: {\n          OPEN: FsmConnectorStates.StateOpened,\n          SESSIONACTIVATE: FsmConnectorStates.StateSessionActive,\n          LOCK: FsmConnectorStates.StateLocked,\n          END: FsmConnectorStates.StateEnd\n        }\n      },\n      sessionActive: { on: {\n          OPEN: FsmConnectorStates.StateOpened,\n          SESSIONCLOSE: FsmConnectorStates.StateClosed,\n          LOCK: FsmConnectorStates.StateLocked,\n          END: FsmConnectorStates.StateEnd\n        }\n      },\n      sessionClosed: { on: {\n          IDLE: FsmConnectorStates.StateIdle,\n          OPEN: FsmConnectorStates.StateOpened,\n          CLOSE: FsmConnectorStates.StateClosed,\n          SESSIONRESTART: FsmConnectorStates.StateSessionRestart,\n          LOCK: FsmConnectorStates.StateLocked,\n          UNLOCK: FsmConnectorStates.StateUnlocked,\n          END: FsmConnectorStates.StateEnd\n        }\n      },\n      sessionRestart: { on: {\n          IDLE: FsmConnectorStates.StateIdle,\n          SESSIONCLOSE: FsmConnectorStates.StateClosed,\n          OPEN: FsmConnectorStates.StateOpened,\n          CLOSE: FsmConnectorStates.StateClosed,\n          LOCK: FsmConnectorStates.StateLocked,\n          END: FsmConnectorStates.StateEnd\n        }\n      },\n      closed: { on: {\n          OPEN: FsmConnectorStates.StateOpened,\n          LOCK: FsmConnectorStates.StateLocked,\n          UNLOCK: FsmConnectorStates.StateUnlocked,\n          END: FsmConnectorStates.StateEnd,\n          IDLE: FsmConnectorStates.StateIdle\n        }\n      },\n      locked: { on: {\n          SESSIONCLOSE: FsmConnectorStates.StateClosed,\n          OPEN: FsmConnectorStates.StateOpened,\n          CLOSE: FsmConnectorStates.StateClosed,\n          LOCK: FsmConnectorStates.StateLocked,\n          UNLOCK: FsmConnectorStates.StateUnlocked,\n          SESSIONRESTART: FsmConnectorStates.StateSessionRestart,\n          RECONFIGURE: FsmConnectorStates.StateReconfigured,\n          STOP: FsmConnectorStates.StateStopped,\n          RENEW: FsmConnectorStates.StateRenewed,\n          END: FsmConnectorStates.StateEnd\n        }\n      },\n      unlocked: { on: {\n          IDLE: FsmConnectorStates.StateIdle,\n          OPEN: FsmConnectorStates.StateOpened,\n          END: FsmConnectorStates.StateEnd,\n          LOCK: FsmConnectorStates.StateLocked\n        }\n      },\n      stopped: { on: {}},\n      end: { on: {}},\n      reconfigured: { on: {}},\n      renewed: { on: {}}\n    }\n  })\n}\n\nconst startConnectorMachineService = (toggleMachine: any) => {\n  return interpret(toggleMachine).start()\n}\n\nconst subscribeConnectorFSMService = (service: TodoTypeAny, eventFn: (state: any) => void) => {\n  if(service === undefined || eventFn === undefined) throw new Error('Service or event handler missing')\n\n  return service.subscribe(eventFn)\n}\n\nfunction setListenerToClient(node: TodoTypeAny) {\n\n  if (!node.iiot.opcuaClient) {\n    logger.internalDebugLog('Client Not Valid On Setting Events To Client')\n    if (node.showErrors) {\n      node.error(new Error('Client Not Valid To Set Event Listeners'), {payload: 'No Client To Set Event Listeners'})\n    }\n    return\n  }\n\n  node.iiot.opcuaClient.on('close', function (err: Error) {\n    if (err) {\n      logger.internalDebugLog('Connection Error On Close ' + err)\n    }\n\n    if (node.iiot.isInactiveOnOPCUA()) {\n      logger.detailDebugLog('Connector Not Active On OPC UA Close Event')\n    } else {\n      node.iiot.resetOPCUAConnection('Connector To Server Close')\n    }\n\n    logger.internalDebugLog('!!!!!!!!!!!!!!!!!!!!!!!!  CLIENT CONNECTION CLOSED !!!!!!!!!!!!!!!!!!!')\n    logger.internalDebugLog('CONNECTION CLOSED: ' + node.endpoint)\n    node.emit('server_connection_close')\n  })\n\n  node.iiot.opcuaClient.on('backoff', function (number: number, delay: number) {\n    logger.internalDebugLog('!!! CONNECTION FAILED (backoff) FOR #', number, ' retrying ', delay / 1000.0, ' sec. !!!')\n    logger.internalDebugLog('CONNECTION FAILED: ' + node.endpoint)\n    node.iiot.stateService.send('LOCK')\n  })\n\n  node.iiot.opcuaClient.on('abort', function () {\n    logger.internalDebugLog('!!! Abort backoff !!!')\n    logger.internalDebugLog('CONNECTION BROKEN: ' + node.endpoint)\n\n    if (node.iiot.isInactiveOnOPCUA()) {\n      logger.detailDebugLog('Connector Not Active On OPC UA Backoff Abort Event')\n    } else {\n      node.iiot.resetOPCUAConnection('Connector To Server Backoff Abort')\n    }\n\n    node.emit('server_connection_abort')\n  })\n\n  node.iiot.opcuaClient.on('connection_lost', function () {\n    logger.internalDebugLog('!!!!!!!!!!!!!!!!!!!!!!!!  CLIENT CONNECTION LOST !!!!!!!!!!!!!!!!!!!')\n    logger.internalDebugLog('CONNECTION LOST: ' + node.endpoint)\n    node.iiot.stateService.send('LOCK')\n    node.emit('server_connection_lost')\n  })\n\n  node.iiot.opcuaClient.on('connection_reestablished', function () {\n    logger.internalDebugLog('!!!!!!!!!!!!!!!!!!!!!!!!  CLIENT CONNECTION RE-ESTABLISHED !!!!!!!!!!!!!!!!!!!')\n    logger.internalDebugLog('CONNECTION RE-ESTABLISHED: ' + node.endpoint)\n    node.iiot.stateService.send('UNLOCK')\n  })\n\n  node.iiot.opcuaClient.on('start_reconnection', function () {\n    logger.internalDebugLog('!!!!!!!!!!!!!!!!!!!!!!!!  CLIENT STARTING RECONNECTION !!!!!!!!!!!!!!!!!!!')\n    logger.internalDebugLog('CONNECTION STARTING RECONNECTION: ' + node.endpoint)\n    node.iiot.stateService.send('LOCK')\n  })\n\n  node.iiot.opcuaClient.on('timed_out_request', function () {\n    logger.internalDebugLog('!!!!!!!!!!!!!!!!!!!!!!!! CLIENT TIMED OUT REQUEST !!!!!!!!!!!!!!!!!!!')\n    logger.internalDebugLog('CONNECTION TIMED OUT REQUEST: ' + node.endpoint)\n  })\n\n  node.iiot.opcuaClient.on('security_token_renewed', function () {\n    logger.detailDebugLog('!!!!!!!!!!!!!!!!!!!!!!!! CLIENT SECURITY TOKEN RENEWED !!!!!!!!!!!!!!!!!!!')\n    logger.detailDebugLog('CONNECTION SECURITY TOKEN RENEWED: ' + node.endpoint)\n  })\n\n  node.iiot.opcuaClient.on('after_reconnection', function () {\n    logger.internalDebugLog('!!!!!!!!!!!!!!!!!!!!!!!!      CLIENT RECONNECTED     !!!!!!!!!!!!!!!!!!!')\n    logger.internalDebugLog('CONNECTION RECONNECTED: ' + node.endpoint)\n    node.emit('after_reconnection', node.iiot.opcuaClient)\n    node.iiot.stateService.send('UNLOCK')\n  })\n}\n\nfunction logSessionInformation(node: TodoTypeAny) {\n  if (!node.iiot?.opcuaSession) {\n    logger.detailDebugLog('Session Not Valid To Log Information')\n    return\n  }\n\n  logger.internalDebugLog('Session ' + node.iiot.opcuaSession.name + ' Id: ' + node.iiot.opcuaSession.sessionId + ' Started On ' + node.endpoint)\n  logger.detailDebugLog('name :' + node.iiot.opcuaSession.name)\n  logger.detailDebugLog('sessionId :' + node.iiot.opcuaSession.sessionId)\n  logger.detailDebugLog('authenticationToken :' + node.iiot.opcuaSession.authenticationToken)\n  logger.internalDebugLog('timeout :' + node.iiot.opcuaSession.timeout)\n\n  if (node.iiot.opcuaSession.serverNonce) {\n    logger.detailDebugLog('serverNonce :' + node.iiot.opcuaSession.serverNonce ? node.iiot.opcuaSession.serverNonce.toString('hex') : 'none')\n  }\n\n  if (node.iiot.opcuaSession.serverCertificate) {\n    logger.detailDebugLog('serverCertificate :' + node.iiot.opcuaSession.serverCertificate ? node.iiot.opcuaSession.serverCertificate.toString('base64') : 'none')\n  } else {\n    logger.detailDebugLog('serverCertificate : None')\n  }\n\n  logger.detailDebugLog('serverSignature :' + node.iiot.opcuaSession.serverSignature ? node.iiot.opcuaSession.serverSignature : 'none')\n\n  if (node.iiot.opcuaSession.lastRequestSentTime) {\n    logger.detailDebugLog('lastRequestSentTime : ' + node.iiot.opcuaSession.lastRequestSentTime)\n    logger.internalDebugLog('lastRequestSentTime converted :' + node.iiot.opcuaSession.lastRequestSentTime ? new Date(node.iiot.opcuaSession.lastRequestSentTime).toISOString() : 'none')\n  }\n\n  if (node.iiot.opcuaSession.lastResponseReceivedTime) {\n    logger.detailDebugLog('lastResponseReceivedTime : ' + node.iiot.opcuaSession.lastResponseReceivedTime)\n    logger.internalDebugLog('lastResponseReceivedTime converted :' + node.iiot.opcuaSession.lastResponseReceivedTime ? new Date(node.iiot.opcuaSession.lastResponseReceivedTime).toISOString() : 'none')\n  }\n}\n\nfunction checkEndpoint(endpoint: string, errorHandler: (err: Error) => void) {\n  if (endpoint && endpoint.includes('opc.tcp://') && endpoint.lastIndexOf(':') > 8) {\n    return true\n  } else {\n    logger.internalDebugLog('Endpoint Not Valid -> ' + endpoint)\n    errorHandler(new Error('endpoint does not include opc.tcp://'))\n    return false\n  }\n}\n\nconst coreConnector = {\n  initConnectorNode,\n  createConnectorFinalStateMachine,\n  startConnectorMachineService,\n  subscribeConnectorFSMService,\n  setListenerToClient,\n  logSessionInformation,\n  checkEndpoint,\n  internalDebugLog: logger.internalDebugLog\n}\n\nexport default coreConnector\n"]}